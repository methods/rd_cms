{% from "cms_autosave/macros.html" import editable_accordian_item_checkboxes, editable_accordian_item_text, editable_accordian_item_textarea %}

{# Unpack the individual data types from types_of_data and secondary_source_1_type_of_data into lists matching the checkbox values #}
{% set primary_source_checked_types_of_data = [] %}
{% for data_type in measure.type_of_data %}
    {% do primary_source_checked_types_of_data.append(data_type.value) %}
{% endfor %}

{% set secondary_source_checked_types_of_data = [] %}
{% for data_type in measure.secondary_source_1_type_of_data %}
    {% do secondary_source_checked_types_of_data.append(data_type.value) %}
{% endfor %}

<div class="accordion-section">
    <div class="accordion-section-header">
        <h2 class="heading-medium">Data sources</h2>
    </div>
    <div class="accordion-section-body">
    {# PRIMARY SOURCE #}
    {{ editable_accordian_item_text("Source", measure.source_url, field_name="source_url", empty_message="TODO: MAKE THIS A LINK UNDER HEADING Source WITH TWO BOXES source_url AND source_text", tab_index=14) }}
    {{ editable_accordian_item_checkboxes("Type of data", primary_source_checked_types_of_data, all_values=["Administrative", "Survey"], field_name="type_of_data", empty_message="Click to add type of data", tab_index=15) }}
    {{ editable_accordian_item_text("Type of statistic", measure.type_of_statistic_id, field_name="type_of_statistic_id", empty_message="TODO: FIGURE OUT HOW ID MAPS TO STATISTIC TYPES IN FRONTEND", tab_index=16) }}
    {{ editable_accordian_item_text("Publisher", measure.department_source_id, field_name="department_source_id", empty_message="TODO: FIGURE OUT HOW ID MAPS TO DEPTS INN FRONTEND", tab_index=17) }}
    {{ editable_accordian_item_text("Publication release date", measure.published_date, field_name="published_date", empty_message="Click to add", tab_index=18) }}
    {{ editable_accordian_item_textarea("Note on corrections or updates", measure.note_on_corrections_or_updates, field_name="note_on_corrections_or_updates", empty_message="Click to add", tab_index=19) }}
    {{ editable_accordian_item_text("Publication frequency", measure.frequency_id, field_name="frequency_id", empty_message="TODO: NEEDS CHECKBOXES PLUS 'OTHER' TEXT FIELD", tab_index=20) }}
    {{ editable_accordian_item_textarea("Purpose of data source", measure.data_source_purpose, field_name="data_source_purpose", empty_message="Click to add", tab_index=21) }}

    {# SECONDARY SOURCE #}
        <div class="secondary-source">
        {{ editable_accordian_item_text("Secondary source", measure.secondary_source_1_url, field_name="secondary_source_1_url", empty_message="TODO: MAKE THIS A LINK UNDER HEADING Secondary source WITH TWO BOXES secondary_source_1_url AND secondary_source_1_title", tab_index=22) }}
        {{ editable_accordian_item_checkboxes("Type of data", secondary_source_checked_types_of_data, all_values=["Administrative", "Survey"], field_name="secondary_source_1_type_of_data", empty_message="Click to add type of data", tab_index=23) }}
        {{ editable_accordian_item_text("Type of statistic", measure.secondary_source_1_type_of_statistic_id, field_name="secondary_source_1_type_of_statistic_id", empty_message="TODO: FIGURE OUT HOW ID MAPS TO STATISTIC TYPES IN FRONTEND", tab_index=24) }}
        {{ editable_accordian_item_text("Publisher", measure.secondary_source_1_publisher_id, field_name="secondary_source_1_publisher_id", empty_message="TODO: FIGURE OUT HOW ID MAPS TO DEPTS INN FRONTEND", tab_index=25) }}
        {{ editable_accordian_item_text("Publication release date", measure.secondary_source_1_date, field_name="secondary_source_1_date", empty_message="Click to add", tab_index=26) }}
        {{ editable_accordian_item_textarea("Note on corrections or updates", measure.secondary_source_1_note_on_corrections_or_updates, field_name="secondary_source_1_note_on_corrections_or_updates", empty_message="Click to add", tab_index=27) }}
        {{ editable_accordian_item_text("Publication frequency", measure.secondary_source_1_frequency_id, field_name="secondary_source_1_frequency_id", empty_message="TODO: NEEDS CHECKBOXES PLUS 'OTHER' TEXT FIELD", tab_index=28) }}
        {{ editable_accordian_item_textarea("Purpose of data source", measure.secondary_source_1_data_source_purpose, field_name="secondary_source_1_data_source_purpose", empty_message="Click to add", tab_index=29) }}
        </div>
    </div>
</div>

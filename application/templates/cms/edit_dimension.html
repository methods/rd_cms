{% extends "cms/create_dimension.html" %}

{% block title %}{% endblock %}
{% block page_title %}
    <h1 class="heading-large">Edit Dimension</h1>
{% endblock %}
{% block measure_form %}
    <div class="edit-form">
        <form id="dimension_form" method="POST"
              action="{{ url_for('cms.edit_dimension', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid )}}">
            {{ form.csrf_token }}
            {% block fields %}
                {{ super() }}
            {% endblock fields %}
            <button type="submit" class="button">Update</button>
            <div id="charts">
                <h2 class="heading-medium">Charts & Tables</h2>
                <table>
                    {% if dimension.chart and dimension.chart != '""' %}
                        <tr>
                            <td>Chart</td>
                            <td>{{ dimension.chart.title.value }}</td>
                            <td><a id="edit_chart" href="{{ url_for('cms.create_chart', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">edit</a></td>
                            <td><a id="delete_chart" href="{{ url_for('cms.delete_chart', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">delete</a></td>
                        </tr>
                    {% endif %}
                    {% if dimension.table and dimension.table != '""' %}
                        <tr>
                            <td>Table</td>
                            {#  this get for title is temp fix for until title in always created#}
                            <td>{{ dimension.table.get('title', '') }}</td>
                            <td><a id="edit_table" href="{{ url_for('cms.create_table', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">edit</a></td>
                            <td><a id="delete_table" href="{{ url_for('cms.delete_table', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">delete</a></td>
                        </tr>
                    {% endif %}
                </table>

                <ul class= "button-group">
                    {% if not dimension.chart or dimension.chart == '""' %}
                    <li>
                        <a id="create_chart" class="button" href="{{ url_for('cms.create_chart', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">
                            Add chart
                        </a>
                    </li>
                    {% endif %}
                    {% if not dimension.table or dimension.table == '""' %}
                    <li>
                        <a id="create_table" class="button" href="{{ url_for('cms.create_table', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid)}}">
                            Add table
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </form>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            function submitForm(data) {
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('cms.edit_dimension', topic=topic.guid, subtopic=subtopic.guid, measure=measure.guid, dimension=dimension.guid )}}",
                    data: data,
                    success: function () {
                    }
                });
            }

            $("#create_chart").click(function (event) {
                var data = $('#dimension_form').serializeArray().reduce(function (obj, item) {
                    obj[item.name] = item.value;
                    return obj;
                }, {});
                submitForm(data)
            });

            $("#edit_chart").click(function (event) {
                var data = $('#dimension_form').serializeArray().reduce(function (obj, item) {
                    obj[item.name] = item.value;
                    return obj;
                }, {});
                submitForm(data)
            });

            $("#create_table").click(function (event) {
                var data = $('#dimension_form').serializeArray().reduce(function (obj, item) {
                    obj[item.name] = item.value;
                    return obj;
                }, {});
                submitForm(data)
            });

            $("#edit_table").click(function (event) {
                var data = $('#dimension_form').serializeArray().reduce(function (obj, item) {
                    obj[item.name] = item.value;
                    return obj;
                }, {});
                submitForm(data)
            });

        });

    </script>
{% endblock measure_form %}

